# Introducción
Este documento muestra algunas de las funciones comunmente más empleadas en el desarrollo de malware. Se incluyen una breve información de su funcionalidad y uso.

**FUENTE:** Sikorski, M., Honig, A. (2012). *Practical malware analysis.* San Francisco: No Starch Press, pp. 453-464


# Funciones

**accept**

+ Used to listen for incoming connections. This function indicates that the program will listen for incoming connections on a socket.


**AdjustTokenPrivileges**
+ Used to enable or disable specific access privileges. Malware that performs process injection often calls this function to gain additional 
permissions.

**AttachThreadInput**

+ Attaches the input processing for one thread to another so that the second thread receives input events such as keyboard and mouse events. Keyloggers and other spyware use this function.

**bind**
+ Used to associate a local address to a socket in order to listen for incoming connections.

**BitBlt**
+ Used to copy graphic data from one device to another. Spyware sometimes uses this function to capture screenshots. This function is often added by the compiler as part of library code.

**CallNextHookEx**
+ Used within code that is hooking an event set by SetWindowsHookEx. CallNextHookEx calls the next hook in the chain. Analyze the function calling CallNextHookEx to determine the purpose of a hook set by 
SetWindowsHookEx.

**CertOpenSystemStore**
+ Used to access the certificates stored on the local system.

**CheckRemoteDebuggerPresent**
+ Checks to see if a specific process (including your own) is being debugged. This function is sometimes used as part of an anti-debugging technique. 

**CoCreateInstance**
+ Creates a COM object. COM objects provide a wide variety of functionality. The class identifier (CLSID) will tell you which file contains the code that implements the COM object.

**connect**
+ Used to connect to a remote socket. Malware often uses low-level functionality to connect to a command-and-control server.

**ConnectNamedPipe**
+ Used to create a server pipe for interprocess communication that will wait for a client pipe to connect. Backdoors and reverse shells sometimes use ConnectNamedPipe to simplify connectivity to a command-and-control server.

**ControlService**
+ Used to start, stop, modify, or send a signal to a running service. If malware is using its own malicious service, you’ll need to analyze the code that implements the service in order to determine the purpose of the call.

**CreateFile**
+ Creates a new file or opens an existing file.

**CreateFileMapping**
+ Creates a handle to a file mapping that loads a file into memory and makes it accessible via memory addresses. Launchers, loaders, and injectors use this function to read and modify PE files. 

**CreateMutex**
+ Creates a mutual exclusion object that can be used by malware to ensure that only a single instance of the malware is running on a system at any given time. Malware often uses fixed names for mutexes, which can be 
good host-based indicators to detect additional installations of the malware.

**CreateProcess**
+ Creates and launches a new process. If malware creates a new process, you will need to analyze the new process as well.

**CreateRemoteThread**
+ Used to start a thread in a remote process (one other than the calling process). Launchers and stealth malware use CreateRemoteThread to inject code into a different process.

**CreateService**
+ Creates a service that can be started at boot time. Malware uses CreateService for persistence, stealth, or to load kernel drivers.

**CreateToolhelp32Snapshot**
+ Used to create a snapshot of processes, heaps, threads, and modules. Malware often uses this function as part of code that iterates through processes or threads.

**CryptAcquireContext**
+ Often the first function used by malware to initialize the use of Windows encryption. There are many other functions associated with encryption, most of which start with Crypt. 

**DeviceIoControl**
+ Sends a control message from user space to a device driver. DeviceIoControl is popular with kernel malware because it is an easy, flexible way to pass information between user space and kernel space.

**Funciones exportadas que indican la implementación de un servidor COM**
+ **DllCanUnloadNow**
+ **DllGetClassObject**
+ **DllInstall**
+ **DllRegisterServer**
+ **DllUnregisterServer**

**EnableExecuteProtectionSupport**
+ An undocumented API function used to modify the Data Execution Protection (DEP) settings of the host, making it more susceptible to attack.

**EnumProcesses**
+ Used to enumerate through running processes on the system. Malware often enumerates through processes to find a process to inject into.

**EnumProcessModules**
+ Used to enumerate the loaded modules (executables and DLLs) for a given process. Malware enumerates through modules when doing injection.

**FindFirstFile/FindNextFile**
+ Used to search through a directory and enumerate the filesystem. 

**FindResource**
+ Used to find a resource in an executable or loaded DLL. Malware sometimes uses resources to store strings, configuration information, or other malicious files. If you see this function used, check for a .rsrc section in the malware’s PE header.

**FindWindow**
+ Searches for an open window on the desktop. Sometimes this function is used as an anti-debugging technique to search for OllyDbg windows.

**FtpPutFile**
+ A high-level function for uploading a file to a remote FTP server.

**GetAdaptersInfo**
+ Used to obtain information about the network adapters on the system. Backdoors sometimes call GetAdaptersInfo as part of a survey to gather information about infected machines. In some cases, it’s used to gather MAC addresses to check for VMware as part of anti-virtual machine techniques

**GetAsyncKeyState**
+ Used to determine whether a particular key is being pressed. Malware sometimes uses this function to implement a keylogger.

**GetDC**
+ Returns a handle to a device context for a window or the whole screen. Spyware that takes screen captures often uses this function.

**GetForegroundWindow**
+ Returns a handle to the window currently in the foreground of the desktop. Keyloggers commonly use this function to determine in which window the user is entering his keystrokes.

**gethostbyname**
+ Used to perform a DNS lookup on a particular hostname prior to making an IP connection to a remote host. Hostnames that serve as commandand-control servers often make good network-based signatures.

**gethostname**
+ Retrieves the hostname of the computer. Backdoors sometimes use gethostname as part of a survey of the victim machine.

**GetKeyState**
+ Used by keyloggers to obtain the status of a particular key on the keyboard.

**GetModuleFilename**
+ Returns the filename of a module that is loaded in the current process. Malware can use this function to modify or copy files in the currently running process.

**GetModuleHandle**
+ Used to obtain a handle to an already loaded module. Malware may use GetModuleHandle to locate and modify code in a loaded module or to search for a good location to inject code.

**GetProcAddress**
+ Retrieves the address of a function in a DLL loaded into memory. Used to import functions from other DLLs in addition to the functions imported in the PE file header.

**GetStartupInfo**
+ Retrieves a structure containing details about how the current process was configured to run, such as where the standard handles are directed.

**GetSystemDefaultLangId**
+ Returns the default language settings for the system. This can be used to customize displays and filenames, as part of a survey of an infected victim, or by “patriotic” malware that affects only systems from certain regions.

**GetTempPath**
+ Returns the temporary file path. If you see malware call this function, check whether it reads or writes any files in the temporary file path.

**GetThreadContext**
+ Returns the context structure of a given thread. The context for a thread stores all the thread information, such as the register values and current state.

**GetTickCount**
+ Retrieves the number of milliseconds since bootup. This function is sometimes used to gather timing information as an anti-debugging technique. GetTickCount is often added by the compiler and is included in many executables, so simply seeing it as an imported function provides little information.

**GetVersionEx**
+ Returns information about which version of Windows is currently running. This can be used as part of a victim survey or to select between different offsets for undocumented structures that have changed between different versions of Windows.

**GetWindowsDirectory**
+ Returns the file path to the Windows directory (usually C:\Windows). Malware sometimes uses this call to determine into which directory to install additional malicious programs.

**inet_addr**
+ Converts an IP address string like 127.0.0.1 so that it can be used by functions such as connect. The string specified can sometimes be used as a network-based signature.

**InternetOpen**
+ Initializes the high-level Internet access functions from WinINet, such as InternetOpenUrl and InternetReadFile. Searching for InternetOpen is a good way to find the start of Internet access functionality. One of the parameters to InternetOpen is the User-Agent, which can sometimes make a good 
network-based signature.

**InternetOpenUrl**
+ Opens a specific URL for a connection using FTP, HTTP, or HTTPS. URLs, if fixed, can often be good network-based signatures.

**InternetReadFile**
Reads data from a previously opened URL.

**InternetWriteFile**
+ Writes data to a previously opened URL.

**IsDebuggerPresent**
+ Checks to see if the current process is being debugged, often as part of an anti-debugging technique. This function is often added by the compiler and is included in many executables, so simply seeing it as an imported function provides little information.

**IsNTAdmin**
+ Checks if the user has administrator privileges.
