# Files and File Formats
A malware analyst needs to be aware of the various file formats and how to identify them. In the following sections you can find some useful information for identifying files and formats

## Hexadecimal view
You can use many different tools to view a file in its hexadecimal form. My favourite alternative is using vim. You only have to open a file and type `:%!xxd` inside the command mode. Also, you can use syntax highlighting with `:set ft=xxd`. Finally, revert the hexadecimal view using `:%!xxd -r`. For more information see [this vim wiki post](https://vim.fandom.com/wiki/Improved_hex_editing).

This view can be useful for indetifying file formats. You just have to open the file using **vim** and find out the *magic bytes* to associate it to an specific format. Here there are popular *magic bytes* you may find analyzing a file:

**Popular Executable File Formats and Their Magic Bytes**
| OS | File type / format | Magic bytes (HEX) | Magic bytes (ASCII) |
|-|-|-|-|
|Windows|Windows Executable| 4D| 5AMZ |
|Linux|Linux Executable|7F 45 4C 46|.ELF|
|Mach-O|Mach-O Executable|FE ED FA CE|....|

**Popular Nonexecutable File Formats and Their Magic Bytes**
|File Format/Type|File Extension|Magic Bytes (HEX)| Magic Bytes (ASCII) |
|-|-|-|-|
|PDF Document|.pdf|25 50 44 46|%PDF|
|Adobe Flash|.swf|46 57 53|FWS|
|Flash Video|.flv|46 4C 56|FLV|
|Video AVI files|.avi|52 49 46 46|RIFF|
|Zip compressed files|.zip|50 4|BPK|
|Rar compressed files|.rar|52 61 72 21|rar!|
|Microsoft document|.doc|D0 CF||

## Command line tools

1. [file](https://www.geeksforgeeks.org/file-command-in-linux-with-examples/) (Linux)
2. [trid](https://mark0.net/soft-trid-e.html) (Linux / Windows)

![trid output](images/trid-output.png)

In this case, `trid.exe` lists the potential file formats. For `powershell.exe` trid.exe reports with a 37.8% accuracy that it is an executable file compiled using Microsoft Visual C++. The greater the probability, the more likely it is that file format.

# Hashing
Hashing is a method by which any data generates a unique identifier string for that data. The hash value of a malware file is what is used in the malware analysis world to identify and refer to it. Whenever you have a malware file, you generate its hash and then look it up on the Internet for analysis. For example:

- [Virus Total](https://www.virustotal.com/gui/home/upload)
- [Hybrid Analysis](https://www.hybrid-analysis.com)
- [Any.Run](https://app.any.run)

It is important to verify and contrast results using more than one of these analysis platforms.

There are mainly three kinds of hashes that are predominantly used in the malware world for files (**md5**, **sha1**, and **sha256**), each of which is generated by tools that use the hashing algorithms specific to the hash they are generating. Above, you can see basic tools to hash a file in Windows and Linux.

## Powershell

```powershell
Get-FileHash -Path $filePath -Algorithm $hashAlgorithm
```

Where **$hashAlgorithm** can be any of the following

- MD5
- SHA1
- SHA256
- SHA384
- SHA512

## Linux 

```bash
md5sum $filePath
```

```bash
sha256sum $filePath
```

```bash
sha1sum $filePath
```
