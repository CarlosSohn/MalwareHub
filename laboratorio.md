# Implantando un laboratorio

En este documento se explica cómo montar un laboratorio sencillo para realizar análisis dinámico.

## Requisitos

+ [Virtual Box](https://www.virtualbox.org/wiki/Downloads) (última versión)
+ [Kali Linux VM](https://www.kali.org/get-kali/#kali-virtual-machines) (Máquina de análisis)
+ Una Windows VM (Máquina objetivo) con las siguientes herramientas:
  + [Procmon](https://github.com/CarlosSohn/analisis-malware/blob/main/recursos/Procmon.exe)
  + [Regshot](https://github.com/CarlosSohn/analisis-malware/blob/main/recursos/Regshot-x64-Unicode.exe)
  + [ApateDNS](https://github.com/CarlosSohn/analisis-malware/blob/main/recursos/apateDNS.exe)
  + [Procexp](https://github.com/CarlosSohn/analisis-malware/blob/main/recursos/procexp.exe)
  + [Wireshark](https://www.wireshark.org/download.html)

**NOTA:** Se puede usar Virtual Box o VMWare. De igual forma, se puede usar Kali o cualquier otra distribución de Linux (i. e., Ubuntu, Remnux, Arch) como máquina de análisis. Lo importante es que dicha máquina tenga instalado [inetsim](https://www.inetsim.org/downloads.html), ya que es lo que nos permitirá simular algunos servicios de red.

## Creación de una red interna

Lo primero será configurar las máquinas para que se encuentren en una red interna, donde sólo ellas puedan comunicarse. Esto previene, pero no garantiza, que nuestro ordenador sea infecteado por la muestra que ejecutemos. Es por ello que se recomienda tener el software de virtualización actualizado.

### Configuración de red interna en Virtualbox

1. Entramos a la configuración de la máquina (cualquiera de las dos). Específicamente a la pestaña **Red**. 
2. Verificamos que la opción "Habilitar adaptador de red" se encuentra seleccionada
3. En la opción **Conectado a** seleccionarmos **Red interna**. 
4. En la opción **Nombre** escribimos un nombre para nuestra red. Por ejemplo, 'laboratorio'.
5. Damos click en **Aceptar** y realizamos el mismo procedimiento en la otra máquina virtual.

**NOTA:** En la siguiente máquina no hará falta volver a escribir el **nombre** de la red interna, ya que Virtual Box la identifica como una existente. Por ello, debemos seleccionarla dentro de las opciones que nos ofrece la aplicación en **Nombre**.  

### Configuración de red de las máquinas virtuales

Una vez creada nuestra red virtual interna, debemos configurar las máquinas para que puedan comunicarse. Para ello, debemos asignar una IP estática a cada una de ellas, la cual debe tener la misma dirección de red y la misma máscara. Un ejemplo de configuración puede ser la siguiente:

+ Máquina Linux
  + IPv4: 192.168.1.1
  + Máscara de red: 255.255.255.0
+ Máquina Windows
  + Ipv4: 192.168.1.2
  + Máscara de red: 255.255.255.0
  + Puerta de enlace: 192.168.1.1
  + DNS: 192.168.1.1

**NOTA:** Obsérvese que las direcciones de puerta de enlace y dns de Windows corresponden con la Ipv4 de Linux. Esto se hace con el fin de que la máquina Linux reciba y responda a las peticiones que realice el malware (desde Windows).

## Verificar conectividad

Para verificar que todo está en orden, hacemos un ping de la máquina Windows a la máquina Linux. Podemos hacerlo al contrario, pero debemos deshabilitar el firewall de Windows. De lo contrario, no recibirémos ninguna respuesta.


