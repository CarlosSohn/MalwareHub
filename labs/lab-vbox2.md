# Lab using VirtualBox II
> Last update 07-03-2023

## Requirements

**Host requirements**

- A host OS and the hypervisor software fully updated with the latest security patches and updates.
- **200 GB free disk space per VM (SSD)**. You need sufficient disk space to create a VM and multiple snapshots through various phases of analysis. In most cases, a free disk space of 200 GB should suffice.
- **4 GB of spare memory (RAM) per VM**

**Network requirements**

- Isolated / dedicated physicial network

If you do not have access to this requirement, then

- Host only adaptet, even though it is not secure enough.
- Innet is a better option.

**Virtual host requirements**

- It is recommended to use three diffenrent machines
    - Windows XP SP2+ 32-bit
    - Windows 7 64-bit
    - Windows 10 64-bit
- 150 GB Virtual disk
- 4 GB RAM (minimum)
- 2 cores (minimum)
- Guest Additions tools

##  OS configuration

- File Explorer Options
    - [ ] Hide extensions for known file types
    - [X] Show hidden files, folders, and drives 
- Disable [ASLR](https://en.wikipedia.org/wiki/Address_space_layout_randomization) (optional) 
    - From a malware reversing standpoint, to improve speed and efficiency, disabling ASLR is preferable so that the same memory addresses are used for every execution of the same malware sample and its DLL dependencies.
    - In Windows 7 go to `HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\`, then set `MoveImages` 
        - Type = REG_DWORD
        - Data = 0
    - In Windows 10 modify `Windows Security -> App & browser control -> Force randomization for images (Mandatory ASRL)` option
- Disable Windows Firewall  
- Disable all Windows Defender features and any AV software 
- Mimic an end-user system to avoid _armoring_
    - Try using a _normal_ virtual disk size, if possible (around 500 GB)
    - Install software used by most end users like Chrome and Firefox, PDF readers like Adobe Acrobat PDF Reader, productivity tools like Microsoft Office, media players, and so forth.
    - Create dummy files with many different extensions like pdf, doc, pptx, wav, etc.
    - Open and use a couple of these later documents to create a file history

## Tools
**Hashing**

Windows tools for hashins files

1. [HashMyFiles](http://www.nirsoft.net/utils/hash_my_files.html) (GUI)
2. [QuickHash](https://www.quickhash-gui.org/) (GUI)
3. [hashdeep](https://sourceforge.net/projects/md5deep/) (CLI)

**API resources**

1. [APIMiner](https://github.com/poona/APIMiner) (CLI)
    - API log generator for malware execution
2. [MalAPI](https://malapi.io/) (Web)
    - Maps Windows APIs to common techniques used by malware.
3. [NTTrace](https://github.com/rogerorr/NtTrace) (CLI)
    - loggs native API calls made by a process on Windows.
4. [Malware common imported functions](../imported_functions.md) (Text List)

**PE File Exploration**

Windows/Linux tools for PE file exploration

1. [PEBear](https://github.com/hasherezade/pe-bear-releases) (GUI)
2. [DIE](https://github.com/horsicq/Detect-It-Easy) (GUI)
3. [CFF Explorer](https://ntcore.com/?page_id=388) (GUI)
4. [PEview](http://wjradburn.com/software/) (GUI)
5. [readpe](https://pypi.org/project/readpe/) (CLI)

Tools for packing discovery and PE information

1. [PEiD](https://www.aldeid.com/wiki/PEiD)

**File Type Identification**

1. [file](https://www.geeksforgeeks.org/file-command-in-linux-with-examples/) (CLI)
2. [TrID](https://mark0.net/soft-trid-e.html) (CLI / GUI)

**Process visualization**

1. [Process Hacker](https://processhacker.sourceforge.io/)
2. [Process Explorer](https://learn.microsoft.com/en-us/sysinternals/downloads/process-explorer#download)
3. [CurrProcess](http://www.nirsoft.net/utils/cprocess.html)

**Process monitorization**

1. [Procmon](https://learn.microsoft.com/en-us/sysinternals/downloads/procmon)

**Persistence identification**

1. [AutoRuns](https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns)

**Registry modification**

1. [Regshot](https://sourceforge.net/projects/regshot/) (GUI)
2. [Simple WMI View](http://www.nirsoft.net/utils/simple_wmi_view.html) (GUI)
    - For Windows Management Instrumentation queries

**Network Logging and Simulation**

1. [FakeNet](https://sourceforge.net/projects/fakenet/)
2. [InetSim](https://www.kali.org/tools/inetsim/)
3. [ApateDNS](https://fireeye.market/apps/211380)

**Network Monitor**

1. [Wireshark](https://www.wireshark.org/download.html)
2. [Microsoft Network Monitor](https://www.microsoft.com/en-in/download/details.aspx?id=4865)
3. [Suricata](https://suricata.io/) (CLI / GUI)

**Proxy for network interaction analysis / Web Debbuging**

1. [Fiddler](https://www.telerik.com/fiddler) (GUI)
2. [Burpsuit](https://portswigger.net/burp) (GUI)

**Web page malware analysis**

1. [Malzilla](https://malzilla.org/) (for Java)

**Strings identification**

1. [strings](https://linux.die.net/man/1/strings) (CLI)
2. [DIE](https://github.com/horsicq/Detect-It-Easy) (GUI)

**Pattern matching**

1. [grep](https://www.gnu.org/software/grep/manual/grep.html) (CLI)
2. [YARA](https://virustotal.github.io/yara/) (CLI)

**Debuggers**

1. [OllyDbg](https://www.ollydbg.de/) (GUI)
2. [x64dbg](https://x64dbg.com/) (GUI)
3. [gdb](https://manpages.ubuntu.com/manpages/trusty/es/man1/gdb.1.html) (CLI)

**Disassemblers**

1. [IDA](https://www.hex-rays.com/ida-pro/ida-disassembler/)
2. [Ghidra](https://github.com/NationalSecurityAgency/ghidra)

**Text / Hex Editors**

1. [Notepad++](https://notepad-plus-plus.org/downloads/) 
2. [Vim](https://www.vim.org/)
3. [Emacs](https://www.gnu.org/software/emacs/)

**Memory Dump and research**

1. [FTK Imager](https://www.exterro.com/ftk-imager)
2. [Volatility](https://www.volatilityfoundation.org/releases)
3. [Resgistry Viewer](https://www.exterro.com/ftk-product-downloads/registry-viewer-2-0-0)

**Rootkit/Hooking detection**

1. [ring3](https://www.novirusthanks.org/) (GUI / legacy)
2. [GMER](http://www.gmer.net/) (GUI)
3. [SSDT View](https://www.appsvoid.com/products/ssdt-view/) (GUI / Private)
4. [Driver View](http://www.nirsoft.net/utils/driverview.html) (GUI)

**Information extraction from images**
1. [bulk-extractor](https://downloads.digitalcorpora.org/downloads/bulk_extractor/) (CLI)

**Automated malware analysis**

1. [Cuckoo Sanbox](https://cuckoosandbox.org/)

**OLE File analysis / Macro's detection**

1. [oledump.py](https://blog.didierstevens.com/programs/oledump-py/) (CLI)
2. [DocFileViewerEx](https://www.docfileviewer.wedding-soft.com/) (GUI)


**Manual DLL execution**

1. [rundll32.exe](https://learn.microsoft.com/es-es/windows-server/administration/windows-commands/rundll32) (CLI)


## Snapshots

Once you successfully installed and configured OS and tools, suspend the VM and take a snapshot
